flowchart TB

    %% ---------- LANE 1: SOLICITATION ----------
    subgraph S[SOLICITATION]
        direction TB
        S1(["InÃ­cio: Criar Solicitation<br/>â€¢ Nova solicitaÃ§Ã£o vazia<br/>â€¢ solicitation.orders = []"])
        S2["Adicionar Order na Solicitation<br/>â€¢ Adiciona ao array de orders"]
    end

    %% ---------- LANE 2: ORDER LIFECYCLE ----------
    subgraph O[ORDER LIFECYCLE]
        direction TB
        O1["Criar Order<br/>ğŸŸ¢ status = Pendente de Compra<br/>ğŸ—“ï¸ date_order = null<br/>ğŸ—“ï¸ date_purchase_order = null<br/>ğŸ—“ï¸ date_conference = null"]

        O2["Marcar Compra Realizada<br/>ğŸ”µ status â†’ Compra Realizada<br/>ğŸ—“ï¸ date_order = NOW()<br/>â¡ï¸ Gera Conta a Pagar"]

        O3["Efetivar Pagamento (Baixa)<br/>ğŸŸ¢ status â†’ Compra Quitada<br/>ğŸ—“ï¸ date_purchase_order = NOW()<br/>ğŸŸ  status_conference â†’ A Conferir<br/>âœ… Baixa em Conta a Pagar"]

        O4["Aguardando ConferÃªncia<br/>Status: ğŸŸ¢ Compra Quitada<br/>Conf: ğŸŸ  A Conferir"]

        O5["Finalizar ConferÃªncia<br/>Conf: ğŸŸ¢ Conferido<br/>ğŸ—“ï¸ date_conference = NOW()"]

        O6["Entregar ao Cliente<br/>ğŸŸ¢ status â†’ Entregue<br/>ğŸ—“ï¸ date_delivery = NOW()"]

        %% Alternativo
        O_Alt1["DesistÃªncia / AlteraÃ§Ã£o"]
        O_Alt2["Transformar em Pronta Entrega<br/>ğŸŸ£ status â†’ Pronta Entrega<br/>ğŸ‘¤ Client = null<br/>â¡ï¸ Gera Conta a Receber"]
    end

    %% ---------- LANE 3: FINANCEIRO ----------
    subgraph F[FINANCEIRO]
        direction TB
        CP1["Conta a Pagar (Criada)<br/>Vinc: Order"]
        CP2["Conta a Pagar (Baixada)"]
        CR1["Conta a Receber (Criada)<br/>Vinc: Pronta Entrega"]
    end

    %% RELAÃ‡Ã•ES
    S1 --> S2 --> O1
    
    %% Fluxo Principal
    O1 -- "Confirmar Compra" --> O2
    O2 -- "CriaÃ§Ã£o AutomÃ¡tica" --> CP1
    CP1 -.-> O3
    O2 -- "Pagar" --> O3
    O3 -- "Baixa AutomÃ¡tica" --> CP2
    O3 --> O4
    O4 -- "Conferir" --> O5
    O5 -- "Entregar" --> O6

    %% Fluxo Alternativo
    O1 -.-> O_Alt1
    O2 -.-> O_Alt1
    O_Alt1 --> O_Alt2
    O_Alt2 -- "CriaÃ§Ã£o AutomÃ¡tica" --> CR1
